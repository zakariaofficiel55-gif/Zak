<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Concurrence - Profils</title>
<style>
body { font-family: Arial, sans-serif; background: #f0f8ff; margin:0; padding:20px; color:#333; }
.container { max-width: 900px; margin:0 auto; text-align:center; }

.profile-card {
  display:inline-block;
  width:260px;
  background: linear-gradient(145deg, #ffffff, #e3f2fd);
  margin:15px;
  padding:25px;
  border-radius:15px;
  box-shadow:0 8px 20px rgba(0,0,0,0.15);
  cursor:pointer;
  transition: transform 0.3s, box-shadow 0.3s;
  position: relative;
}
.profile-card:hover { transform: translateY(-5px) scale(1.05); box-shadow:0 12px 25px rgba(0,0,0,0.25); }
.profile-card img { width:110px; height:110px; border-radius:50%; object-fit:cover; border:3px solid #1a237e; margin-bottom:15px; }
.name { font-size:22px; font-weight:bold; color:#0d47a1; margin-bottom:5px; text-transform:uppercase; }
.percentTotal { font-size:18px; color:white; font-weight:bold; margin-top:10px; padding:8px; border-radius:12px; transition: background 0.5s; }

.badge { position: absolute; top:10px; left:-10px; padding:5px 12px; border-radius:12px; font-weight:bold; color:white; font-size:14px; box-shadow:0 2px 5px rgba(0,0,0,0.3); background:#0d47a1; }

.modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.85); align-items:center; justify-content:center; z-index:999; padding:20px; overflow-y:auto; }
.modal.open { display:flex; }
.modal-content { background:#ffffff; border-radius:15px; padding:30px; max-width:900px; width:100%; box-shadow:0 10px 30px rgba(0,0,0,0.25); position:relative; text-align:center; }
#profileTitle { color:#0d47a1; font-size:26px; font-weight:bold; text-transform:uppercase; margin-bottom:8px; }
.backBtn { background:#ff9800; border:none; color:white; padding:5px 15px; border-radius:8px; cursor:pointer; font-weight:bold; text-transform:uppercase; font-size:13px; margin-bottom:20px; }

table { width:100%; border-collapse:collapse; margin-top:10px; }
th, td { border:1px solid #444; padding:10px; text-align:center; }
th { background:#bbdefb; font-weight:bold; }
tbody td { min-width:50px; }
tbody tr:hover { background:#e3f2fd; }
tfoot td { font-weight:bold; background:#e1f5fe; transition: background-color 0.6s ease, color 0.6s ease; }
.scrollable { max-height:400px; overflow-y:auto; margin-top:15px; }

/* Animation vert/rouge clignotant */
@keyframes flashGreen { 0% { background-color: #4caf50; } 50% { background-color: #a5d6a7; } 100% { background-color: #4caf50; } }
@keyframes flashRed { 0% { background-color: #f44336; } 50% { background-color: #ef9a9a; } 100% { background-color: #f44336; } }
.flash-green { animation: flashGreen 1s ease; }
.flash-red { animation: flashRed 1s ease; }
</style>
</head>
<body>

<div class="container">
  <h2 style="color:#1a237e; font-size:28px; margin-bottom:30px;">
    D√©couvrez le talent de nos jeunes prodiges !
  </h2>
  <div id="profilesContainer"></div>
</div>

<div class="modal" id="modal">
  <div class="modal-content">
    <h3 id="profileTitle"></h3>
    <button class="backBtn" onclick="closeModal()">üîô Retour / Fermer</button>
    <div class="scrollable">
      <table id="bulletin">
        <thead>
          <tr>
            <th>Mati√®re</th>
            <th id="comp1Header">Comp√©titeur 1</th>
            <th id="comp2Header">Comp√©titeur 2</th>
          </tr>
        </thead>
        <tbody id="subjectsTable"></tbody>
        <tfoot>
          <tr>
            <td>Total</td>
            <td id="total1">0</td>
            <td id="total2">0</td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
</div>

<script>
const subjectsList = ['Anglais','Fran√ßais','Espagnol','EDHC','Musique','HG','PC','SVT','Maths'];
const profiles = [
  {name:'NIAMPA ZAKARIA',short:'ZAKARIA',notes:{compet1:{}, compet2:{}}, total1:0, total2:0, percent1:0, percent2:0, totalPercent:0},
  {name:'SIENI KENANI JEMUEL',short:'SIENI',notes:{compet1:{}, compet2:{}}, total1:0, total2:0, percent1:0, percent2:0, totalPercent:0},
  {name:'BINI ADJA TEYA JOANA',short:'BINI',notes:{compet1:{}, compet2:{}}, total1:0, total2:0, percent1:0, percent2:0, totalPercent:0}
];

// Initialisation des notes √† 0
profiles.forEach(p=>subjectsList.forEach(sub=>{
  p.notes.compet1[sub]=0;
  p.notes.compet2[sub]=0;
}));

const container = document.getElementById('profilesContainer');
const modal = document.getElementById('modal');
const subjectsTable = document.getElementById('subjectsTable');
const profileTitle = document.getElementById('profileTitle');
const total1 = document.getElementById('total1');
const total2 = document.getElementById('total2');

// Cr√©ation cartes profils avec div percentTotal
profiles.forEach(profile=>{
  const card=document.createElement('div');
  card.className='profile-card';
  const badge=document.createElement('div');
  badge.className='badge';
  badge.innerText='‚≠ê';
  card.appendChild(badge);
  card.innerHTML+=`
    <img src='https://cdn-icons-png.flaticon.com/512/147/147144.png'>
    <div class='name'>${profile.name}</div>
    <div class='percentTotal'>0%</div>
  `;
  card.onclick=()=>openModal(profile.name);
  container.appendChild(card);
});

// Ouvrir modal
function openModal(name){
  const profile=profiles.find(p=>p.name===name);
  const competitors=profiles.filter(p=>p.name!==name);

  profileTitle.innerText=`Profil de ${profile.name}`;
  document.getElementById('comp1Header').innerText=competitors[0].short;
  document.getElementById('comp2Header').innerText=competitors[1].short;

  subjectsTable.innerHTML='';
  subjectsList.forEach(sub=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${sub}</td>
      <td contenteditable="true">${profile.notes.compet1[sub]}</td>
      <td contenteditable="true">${profile.notes.compet2[sub]}</td>
    `;
    subjectsTable.appendChild(tr);

    const td1=tr.cells[1];
    const td2=tr.cells[2];

    td1.addEventListener('input',()=>{
      td1.innerText=td1.innerText.replace(/[^0-9.]/g,'');
      profile.notes.compet1[sub]=parseFloat(td1.innerText)||0;
      updateTotals(profile);
    });

    td2.addEventListener('input',()=>{
      td2.innerText=td2.innerText.replace(/[^0-9.]/g,'');
      profile.notes.compet2[sub]=parseFloat(td2.innerText)||0;
      updateTotals(profile);
    });
  });

  updateTotals(profile);
  modal.classList.add('open');
}

// Calculer totaux et pourcentages dans modal
function updateTotals(profile){
  let sum1=0, sum2=0;
  subjectsList.forEach(sub=>{
    sum1+=profile.notes.compet1[sub];
    sum2+=profile.notes.compet2[sub];
  });
  profile.total1=sum1;
  profile.total2=sum2;
  const totalGeneral=sum1+sum2;
  profile.percent1 = totalGeneral>0 ? (sum1/totalGeneral)*100 : 0;
  profile.percent2 = totalGeneral>0 ? (sum2/totalGeneral)*100 : 0;

  total1.innerHTML = `${sum1.toFixed(2)} (${profile.percent1.toFixed(2)}%)`;
  total2.innerHTML = `${sum2.toFixed(2)} (${profile.percent2.toFixed(2)}%)`;

  updateProfilePercentTotal();
}

// Calculer le pourcentage total sur les cartes avec couleurs selon classement
function updateProfilePercentTotal(){
  // Calculer le total pour chaque profil
  profiles.forEach(profile=>{
    let competitors = profiles.filter(p=>p.name!==profile.name);
    let totalPercent=0;

    competitors.forEach(comp=>{
      const sum = comp.total1+comp.total2;
      if(sum>0){
        if(comp.name===competitors[0].name){
          totalPercent+=comp.percent1;
        } else {
          totalPercent+=comp.percent2;
        }
      }
    });

    profile.totalPercent=totalPercent;
  });

  // Trier pour classement
  const sorted = [...profiles].sort((a,b)=>b.totalPercent-a.totalPercent);

  // Appliquer couleur selon rang
  profiles.forEach(profile=>{
    const card=document.querySelectorAll('.profile-card')[profiles.indexOf(profile)];
    const percentDiv=card.querySelector('.percentTotal');
    percentDiv.innerText=profile.totalPercent.toFixed(2)+'%';

    const rank = sorted.findIndex(p=>p.name===profile.name)+1;
    if(rank===1) percentDiv.style.background='green';
    else if(rank===2) percentDiv.style.background='orange';
    else percentDiv.style.background='red';
  });
}

function closeModal(){ modal.classList.remove('open'); }
</script>
</body>
</html>
